!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("leancloud-realtime")):"function"==typeof define&&define.amd?define("groupchat-receipts",["exports","leancloud-realtime"],e):e((t=t||self).AV=t.AV||{},t.AV)}(this,(function(t,e){"use strict";var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(t,e){return t(e={exports:{}},e.exports),e.exports}var o=r((function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)})),i=r((function(t){var e=t.exports={version:"2.6.5"};"number"==typeof __e&&(__e=e)})),a=(i.version,function(t,e,n){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}}),u=function(t){return"object"==typeof t?null!==t:"function"==typeof t},c=function(t){if(!u(t))throw TypeError(t+" is not an object!");return t},f=function(t){try{return!!t()}catch(t){return!0}},s=!f((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),p=o.document,l=u(p)&&u(p.createElement),y=!s&&!f((function(){return 7!=Object.defineProperty((t="div",l?p.createElement(t):{}),"a",{get:function(){return 7}}).a;var t})),d=Object.defineProperty,h={f:s?Object.defineProperty:function(t,e,n){if(c(t),e=function(t,e){if(!u(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!u(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!u(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!u(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}(e,!0),c(n),y)try{return d(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},m=s?function(t,e,n){return h.f(t,e,function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}(1,n))}:function(t,e,n){return t[e]=n,t},v={}.hasOwnProperty,_=function(t,e){return v.call(t,e)},b=function(t,e,n){var r,u,c,f=t&b.F,s=t&b.G,p=t&b.S,l=t&b.P,y=t&b.B,d=t&b.W,h=s?i:i[e]||(i[e]={}),v=h.prototype,g=s?o:p?o[e]:(o[e]||{}).prototype;for(r in s&&(n=e),n)(u=!f&&g&&void 0!==g[r])&&_(h,r)||(c=u?g[r]:n[r],h[r]=s&&"function"!=typeof g[r]?n[r]:y&&u?a(c,o):d&&g[r]==c?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(c):l&&"function"==typeof c?a(Function.call,c):c,l&&((h.virtual||(h.virtual={}))[r]=c,t&b.R&&v&&!v[r]&&m(v,r,c)))};b.F=1,b.G=2,b.S=4,b.P=8,b.B=16,b.W=32,b.U=64,b.R=128;var g=b;g(g.S+g.F*!s,"Object",{defineProperty:h.f});var w=i.Object,O=function(t,e,n){return w.defineProperty(t,e,n)};var j,P,S=function(t,e,n){return e in t?O(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},M={}.toString,T=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==function(t){return M.call(t).slice(8,-1)}(t)?t.split(""):Object(t)},R=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},E=function(t){return T(R(t))},x=Math.ceil,A=Math.floor,C=function(t){return isNaN(t=+t)?0:(t>0?A:x)(t)},F=Math.min,k=Math.max,I=Math.min,D=r((function(t){var e=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(t.exports=function(t,n){return e[t]||(e[t]=void 0!==n?n:{})})("versions",[]).push({version:i.version,mode:"pure",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})})),q=0,z=Math.random(),G=D("keys"),V=(j=!1,function(t,e,n){var r,o,i=E(t),a=(r=i.length)>0?F(C(r),9007199254740991):0,u=function(t,e){return(t=C(t))<0?k(t+e,0):I(t,e)}(n,a);if(j&&e!=e){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((j||u in i)&&i[u]===e)return j||u||0;return!j&&-1}),B=G[P="IE_PROTO"]||(G[P]=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++q+z).toString(36))}(P)),L="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),N=Object.keys||function(t){return function(t,e){var n,r=E(t),o=0,i=[];for(n in r)n!=B&&_(r,n)&&i.push(n);for(;e.length>o;)_(r,n=e[o++])&&(~V(i,n)||i.push(n));return i}(t,L)},W={f:Object.getOwnPropertySymbols},K={f:{}.propertyIsEnumerable},U=function(t){return Object(R(t))},Y=Object.assign,H=!Y||f((function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach((function(t){e[t]=t})),7!=Y({},t)[n]||Object.keys(Y({},e)).join("")!=r}))?function(t,e){for(var n=U(t),r=arguments.length,o=1,i=W.f,a=K.f;r>o;)for(var u,c=T(arguments[o++]),f=i?N(c).concat(i(c)):N(c),s=f.length,p=0;s>p;)a.call(c,u=f[p++])&&(n[u]=c[u]);return n}:Y;g(g.S+g.F,"Object",{assign:H});var J=i.Object.assign,Q=r((function(t,e){!function(e){var n=function(){},r=Object.prototype.hasOwnProperty,o=Object.create||function(t){var e=function(){};return e.prototype=t,new e},i=Object.keys||function(t){var e=[];for(var n in t)r.call(t,n)&&e.push(n);return e},a=function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);return t},u=Object.setPrototypeOf||a,c=Object.prototype.toString,f=Array.isArray||function(t){return"[object Array]"===c.call(t)},s=function(t){return"[object Function]"===c.call(t)},p=!0,l={toString:""};for(var y in l)l.hasOwnProperty(y)&&(p=!1);var d=p?["toString","valueOf"]:null;function h(t,e,r){for(var o,a,u=function(t){var e=i(t);if(p)for(var n,r=0;n=d[r++];)t.hasOwnProperty(n)&&e.push(n);return e}(r),c=0,f=u.length;c<f;)"__self"!==(o=u[c++])&&(a=r[o],s(a)&&(!a.prototype||!a.prototype.__self)&&a.toString().indexOf(".__base")>-1?e[o]=function(r,o){var i=t[r]?t[r]:"__constructor"===r?e.__self.__parent:n,a=function(){var t=this.__base;this.__base=a.__base;var e=o.apply(this,arguments);return this.__base=t,e};return a.__base=i,a}(o,a):e[o]=a)}function m(t,e){for(var n,r=1;n=t[r++];)e?s(n)?v.self(e,n.prototype,n):v.self(e,n):e=s(n)?v(t[0],n.prototype,n):v(t[0],n);return e||t[0]}function v(){var t=arguments,e=f(t[0]),r=e||s(t[0]),i=r?e?m(t[0]):t[0]:n,c=t[r?1:0]||{},p=t[r?2:1],l=c.__constructor||r&&i.prototype&&i.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:r?function(){return i.apply(this,arguments)}:function(){};if(!r)return l.prototype=c,l.prototype.__self=l.prototype.constructor=l,a(l,p);u(l,i),l.__parent=i;var y=i.prototype,d=l.prototype=o(y);return d.__self=d.constructor=l,c&&h(y,d,c),p&&h(i,l,p),l}v.self=function(){var t=arguments,e=f(t[0]),n=e?m(t[0],t[0][0]):t[0],r=t[1],o=t[2],i=n.prototype;return r&&h(i,i,r),o&&h(n,n,o),n};var _=!0;t.exports=v,_=!1,"object"==typeof modules&&"function"==typeof modules.define&&(modules.define("inherit",(function(t){t(v)})),_=!1),_&&(e.inherit=v)}(n)}));if(!e.TypedMessage)throw new Error("LeanCloud Realtime SDK not installed");var X=Q(e.TypedMessage,{__constructor:function(t){this.__base(),this.timestamp=new Date(t)}});e.messageType(-101)(X),e.messageField(["timestamp"])(X),X.sendOptions={transient:!0};var Z={name:"leancloud-realtime-plugin-groupchat-receipts",messageClasses:[X],onIMClientCreate:function(t){var e=t._sendReadCommand;t._sendReadCommand=function(n){n.forEach((function(t){!t.transient&&t.members.length>2&&t.send(new X(t.lastMessageAt||new Date)).catch((function(t){return console.warn("Sending groupchat receipt fail: ".concat(t.message))}))}));for(var r=arguments.length,o=new Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return e.call.apply(e,[t,n].concat(o))}},onConversationCreate:function(t){var e=t.queryMessages;t.queryMessages=function(){!t.transient&&t.members.length>2&&!t.lastReadTimestamps&&t._fetchAllReceiptTimestamps().then((function(e){t.lastReadTimestamps=e.reduce((function(t,e){var n=e.pid,r=e.lastReadAt;return J(t,S({},n,r))}),{}),t.emit("lastreadtimestampsupdate",t.lastReadTimestamps)})).catch((function(t){return console.warn("Initialize group receipts fail: ".concat(t.message))}));for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return e.call.apply(e,[t].concat(r))}},beforeMessageDispatch:function(t,e){return t.type!==X.TYPE||(e.lastReadTimestamps&&(e.lastReadTimestamps[t.from]=t.timestamp,e.emit("lastreadtimestampsupdate",S({},t.from,t.timestamp))),!1)}};t.GroupchatReceiptsPlugin=Z,t.ReadReceipt=X,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=groupchat-receipts.min.js.map
